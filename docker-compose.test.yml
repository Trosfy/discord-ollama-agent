# Docker Compose override for testing
# Usage: docker-compose -f docker-compose.yml -f docker-compose.test.yml run --rm fastapi-service-test

services:
  fastapi-service-test:
    build:
      context: ./fastapi-service
      dockerfile: Dockerfile
    environment:
      - DYNAMODB_ENDPOINT=http://dynamodb-local:8000
      - LOGGING_HOST=logging-service
      - LOGGING_PORT=9999
      - PYTHONPATH=/shared
    volumes:
      - ./fastapi-service:/app
      - ./shared:/shared
    command: >
      sh -c "
        echo 'Installing dependencies and pytest...' &&
        uv pip install --system . &&
        uv pip install --system pytest pytest-asyncio &&
        echo 'Running tests...' &&
        pytest tests/ -v --tb=short
      "
    depends_on:
      dynamodb-local:
        condition: service_healthy
      logging-service:
        condition: service_healthy
